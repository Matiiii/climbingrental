<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <link th:include="fragments/header :: head" th:remove="tag"/>
    <link th:href="@{/css/cart.css}" href="../static/css/cart.css" rel="stylesheet"/>
    <link th:href="@{/css/daterangepicker.css}" href="../static/css/daterangepicker.css" rel="stylesheet"/>
</head>

<body>

<!-- Navigation -->
<div th:replace="fragments/header :: navbar">
</div>

<!-- Page Content -->
<div class="container">
    <div class="row infoContainer">
        <div class="col-xs col-ms col-md-4 imgBasketContainer">
            <div>
                <img class="imgBasket" th:src="@{/images/icon_add_to_cart_740405.png}"
                     src="../static/images/icon_add_to_cart_740405.png"/>
            </div>
            <div>
                <form th:action="@{/createOrder}" method="post">
                    <button class="btn btn-primary" type="submit">Zamów</button>
                </form>
            </div>
        </div>

        <div class="col-xs col-sm col-md-8 info">
            <!-- info for User -->
            <div th:if="${info != null and info.status == true}" th:utext="${info.message}" class="alert alert-success">
                status produktu
            </div>
            <div th:if="${info != null and info.status == false}" th:utext="${info.message}" class="alert alert-danger">
                status produktu
            </div>
            <!-- end info -->
            <div class="base info">
                <p class="orderPeriod">Termin wypożyczenia: <b th:text="${cart.date}">data</b></p>
                <form id="orderPeriod" method="post" th:action="@{/changeDate}">
                    <label for="dateFilter">Zmień termin:</label>
                    <input pattern="^(0?[1-9]|[12]\d|3[01])[\/](0?[1-9]|1[0-2])[\/](20)\d{2}[ ][-][ ](0?[1-9]|[12]\d|3[01])[\/](0?[1-9]|1[0-2])[\/](20)\d{2}$"
                           id="dateFilter" type="text" name="datefilter" autocomplete="off" value=""/>
                    <button type="submit" class="btn btn-success">Zmień</button>
                </form>
                <p>Łączna ilość dni: <b th:text="${cart.getNumberOfDays()}"></b></p>
                <p>Wymagana kaucja: <b th:text="${cart.getCombinedDeposit()}"></b></p>
                <p>Rabat: <b th:if="${user != null}" th:text="${user.getRole().getDiscount() + '%'}"></b></p>
                <p>Łączny koszt z rabatem: <b
                        th:text="(${user != null} ? ${cart.getPriceWithDiscount(user)} : ${cart.getCombinedPrice()})"></b>
                </p>
            </div>
        </div>
    </div>

    <div>
        <div class="row table-head">
            <div class="img">Produkt</div>
            <div class="productName"></div>
            <div class="price">Cena</div>
            <div class="count">Ilość</div>
            <div class="add">Dodaj/Usuń</div>
            <div class="sumPrice">Razem</div>
        </div>
        <div>
            <div th:each="countCartProduct: ${products}" th:attr="product-id=${countCartProduct.getProduct().id}"
                 th:classappend="${countCartProduct.count.compareTo(countCartProduct.countAvailable)==1}? red">
                <div class="row product">
                    <div>
                        <div class="img">

                            <img th:src="${countCartProduct.getProduct().smallImage}"
                                 src="../static/images/LINA_DUZA.jpg"
                                 class="img-responsive"
                                 alt=""/>
                        </div>
                    </div>
                    <div class="productName"><a href="info.html"
                                                th:href="@{'/product/'+${countCartProduct.getProduct().id}}"><h4
                            th:text="${countCartProduct.product.productName}">nazwa produktu</h4></a>
                        <b th:if="${countCartProduct.count.compareTo(countCartProduct.countAvailable)==1}"
                           class="text-danger"
                           th:text="'Dostepnych tylko: ' + ${countCartProduct.getCountAvailable()}">Dostepnych
                            tylko</b></div>
                    <div class="price"><p th:text="${countCartProduct.product.price}">cena</p></div>
                    <div class="count"><p th:text="${countCartProduct.count}">ilość</p></div>
                    <div class="add">
                        <div class="row">
                            <form id="deleteProduct" method="post"
                                  th:action="@{'/cart/deleteProduct/'+${countCartProduct.getProduct().id}}">
                                <button type="submit" class="btn btn-cart btn-outline-danger btn-sm">-</button>
                            </form>
                            <form id="deleteAllProducts" method="post"
                                  th:action="@{'/cart/deleteAllProductsOfOneType/'+${countCartProduct.getProduct().id}}">
                                <button type="submit" class="btn btn-cart btn-outline-danger btn-sm">x</button>
                            </form>
                            <form id="addProduct" method="post"
                                  th:action="@{'/cart/addProduct/'+${countCartProduct.getProduct().id}}"
                                  th:if="${countCartProduct.count.compareTo(countCartProduct.countAvailable)==-1}">
                                <button type="submit" class="btn btn-cart btn-outline-success btn-sm">+</button>
                            </form>

                        </div>
                    </div>
                    <div class="sumPrice"><p th:text="${countCartProduct.product.price * countCartProduct.count}">
                        suma</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- /.container -->

<div class="container">
    <!-- Footer -->
    <footer>
        <div class="row" th:replace="fragments/footer :: footer">static footer</div>
    </footer>
</div>
<!-- /.container -->

<div class="row" th:replace="fragments/footer :: javascript">scripts</div>

<script th:src="@{/js/moment.min.js}" src="../static/js/moment.min.js"></script>
<script th:src="@{/js/daterangepicker.js}" src="../static/js/daterangepicker.js"></script>
<script th:src="@{/js/shopProducts.js}" src="../static/js/shopProducts.js"></script>

</body>

</html>
